# Kick Event Collector

A standalone Node.js script to connect to Kick.com WebSocket and collect events from popular streamers for analysis and event definition building.

## Location

This tool is located in `scripts/event-collection/` for better organization.

## Files

- `event-collector.js` - Main collector script that connects to WebSocket and logs events
- `event-analyzer.js` - Analysis script that processes collected events and generates definitions
- `README-event-collector.md` - This documentation

## Quick Start

1. **Install dependencies**:
   ```bash
   npm install ws
   ```

2. **Run the collector**:
   ```bash
   # From project root
   npm run collect-events
   
   # Or directly
   node scripts/event-collection/event-collector.js
   ```

3. **Let it run for a while** to collect events. It will create a log file like `kick-events-2025-09-14.jsonl`

4. **Analyze the collected events**:
   ```bash
   # From project root  
   npm run analyze-events kick-events-2025-09-14.jsonl
   
   # Or directly
   node scripts/event-collection/event-analyzer.js kick-events-2025-09-14.jsonl
   ```

## What it does

### Event Collector (`event-collector.js`)

- Connects to Kick's WebSocket endpoint (`wss://ws-us2.pusher.com/app/32cbd69e4b950bf97679`)
- Fetches channel data for popular streamers (westcol, xqc, adinross, etc.)
- Subscribes to multiple channel patterns for maximum event coverage:
  - `channel_<streamerId>` - Channel lifecycle events
  - `channel.<streamerId>` - Channel lifecycle events (alternate format)
  - `chatrooms.<chatroomId>` - Chat events
  - `chatrooms.<chatroomId>.v2` - Chat events (v2 format)
  - `chatroom_<chatroomId>` - Chat events (legacy format)

- Logs interesting events to a JSONL file with timestamp, event type, channel, and data
- Provides real-time console output showing event counts
- Handles reconnections automatically
- Graceful shutdown with Ctrl+C

### Event Analyzer (`event-analyzer.js`)

- Parses collected JSONL log files
- Generates statistics on event types and frequencies  
- Analyzes event data structures
- Creates event definitions with descriptions
- Outputs results in both JSON and Markdown formats


### Chat Events
- `App\Events\ChatMessageEvent` - Regular chat messages
- `App\Events\MessageDeletedEvent` - Deleted messages
- `App\Events\UserBannedEvent` - User bans
- `App\Events\UserUnbannedEvent` - User unbans

### Stream Events  
- `App\Events\StreamerIsLive` - Streamer goes live
- `App\Events\StopStreamBroadcast` - Stream ends
- `App\Events\LivestreamUpdated` - Stream info changes

### Interactive Events
- `App\Events\PinnedMessageCreatedEvent` - Messages pinned
- `App\Events\PollUpdateEvent` - Poll updates
- `App\Events\SubEvent` - Subscriptions
- Various support/donation events

## Output Files

### Log Files
- `kick-events-YYYY-MM-DD.jsonl` - Raw event data in JSON Lines format

### Analysis Files  
- `kick-event-definitions-YYYY-MM-DD.json` - Structured event definitions
- `kick-event-definitions-YYYY-MM-DD.md` - Human-readable markdown report

## Usage Tips

1. **Run for at least 30-60 minutes** to get a good sample of events
2. **Peak hours** (evenings US/EU time) will have more activity
3. **Monitor console output** to see which channels are most active
4. **Check file sizes** - active streamers can generate lots of events
5. **Run analyzer multiple times** as you collect more data

## Integration with KickTalk

The event definitions generated by this tool can be used to:

1. **Enhance SupportEventMessage.jsx** with new event types
2. **Update event handling** in the main application
3. **Improve telemetry** by understanding event patterns
4. **Add new notification types** for different events

## Troubleshooting

### Common Issues

1. **"Failed to fetch" errors**: Some streamers may have changed usernames or be inactive
2. **WebSocket disconnections**: The script auto-reconnects every 5 seconds
3. **Large log files**: Events from popular streamers can be very frequent
4. **Missing events**: Some events may require authentication (private channels)

### Rate Limiting

The script includes 1-second delays between API calls to be respectful to Kick's API.

## Example Output

```
ðŸš€ Starting Kick Event Collector

Fetching channel data for popular streamers...
âœ“ westcol: StreamerID=12345, ChatroomID=67890, Live=true
âœ“ xqc: StreamerID=11111, ChatroomID=22222, Live=false
...

âœ“ Connected to Kick WebSocket
âœ“ Connection established. Socket ID: 123456.789012345
âœ“ Subscribed to: channel.12345
âœ“ Subscribed to: chatrooms.67890.v2
...

[1] App\Events\ChatMessageEvent on chatrooms.67890.v2
[2] App\Events\StreamerIsLive on channel.11111
[3] App\Events\SubEvent on chatrooms.67890.v2
...

ðŸ“Š Status: 1247 events collected, 45 channels connected
```

This tool provides a comprehensive way to understand and catalog all the different event types that Kick.com sends through their WebSocket API.